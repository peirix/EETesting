/**
 * Dukt Videos
 *
 * @package		Dukt Videos
 * @version		Version 1.0
 * @author		Benjamin David
 * @copyright	Copyright (c) 2013 - DUKT
 * @link		http://dukt.net/videos/
 *
 *//* -------------------------------------------------------------------- *//* SPIN */$.fn.spin=function(e){dukt_log("$.fn.spin");this.each(function(){var t=$(this),n=t.data();if(n.spinner){n.spinner.stop();delete n.spinner}e!==!1&&(n.spinner=(new Spinner($.extend({color:t.css("color")},e))).spin(this))});return this};$(document).ready(function(){var e={lines:13,length:4,width:2,radius:4,corners:1,rotate:0,color:"#000",speed:2.2,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"7px",left:"6px"};$(".dv-box .dv-status .dv-spin").spin(e);var e={lines:13,length:3,width:2,radius:4,corners:1,rotate:0,color:"#000",speed:2.2,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"0",left:"0"};$(".dv-box .dv-search .dv-spin").spin(e)});var dukt_videos_box={},dukt_videos_ajax_stack=[];jQuery(document).ready(function(e){dukt_log("document ready");dukt_videos_box={init:function(){dukt_log("dukt_videos_box.init()");dukt_videos_box.lightbox.init()},box:!1,utils:{current_service:function(){return e(e(".dv-box .dv-accounts > ul > li.selected > a").get(0)).data("service")}}};dukt_videos_box.lightbox={init:function(){dukt_log("dukt_videos_box.lightbox.init()");var t=e('<div class="dv-overlay loading"><div class="spin"></div></div>');e("body").append(t);e(".dv-overlay").live("click",function(){dukt_videos_box.lightbox.hide()});var n={lines:13,length:5,width:2,radius:5,corners:1,rotate:0,color:"#fff",speed:2.2,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"0",left:"0"};e(".dv-overlay .spin").spin(n);dukt_videos_box.lightbox.resize();e(window).resize(function(){dukt_videos_box.lightbox.resize()})},show:function(){dukt_log("dukt_videos_box.lightbox.show()");e(".dv-overlay").css("display","block");e(".dv-box").css("display","block");if(e(".dv-preview-video iframe").length>0){var t=e(".dv-preview-video iframe").data("embedz");t=t.replace("autoplay=1","autoplay=0");e(".dv-preview-video iframe").attr("src",t)}e(".dv-box .videos li").each(function(){if(e(this).hasClass("selected")){var t={method:"box_preview",service:dukt_videos_box.utils.current_service(),site_id:Dukt_videos.site_id,video_page:e(this).data("video-page"),autoplay:0,rel:0};e(".dv-box .preview").data("video-page",e(this).data("video-page"));e(".dv-box .controls").css("display","block");dukt_videos_box.browser.go(t,"preview",function(){e(".dv-box .controls").css("display","block");dukt_videos_box.box.resize(!0)})}})},hide:function(){dukt_log("dukt_videos_box.lightbox.hide()");e(".dv-overlay").css("display","none");e(".dv-box").css("display","none");if(e(".dv-preview-video iframe").length>0){var t=e(".dv-preview-video iframe").attr("src");e(".dv-preview-video iframe").data("embedz",t);e(".dv-preview-video iframe").attr("src","")}dukt_videos_box.browser.abort("preview")},resize:function(){dukt_log("dukt_videos_box.lightbox.resize()");var t=e(window).width(),n=e(window).height(),r=e(".dv-box").outerWidth(),i=e(".dv-box").outerHeight(),s=Math.round((t-r)/2),o=Math.round((n-i)/2);e(".dv-box").css({left:s,top:o});e(".dv-overlay").css({width:t,height:n})}};dukt_videos_box.ajax_stack={init:function(){dukt_log("dukt_videos_box.ajax_stack.init()");e(".dv-box .dv-status .dv-reload").live("click",function(){dukt_log("dukt_videos_box.ajax_stack.init()","reload all");e(".dv-box .dv-accounts ul ul > li > a").each(function(t,n){var r=e(n).data("listing"),i=e(n).data("service"),s=e(n).data("method");data={method:s,site_id:Dukt_videos.site_id,service:i};var o=!1;e(".dv-box .dv-listing-view").each(function(t,n){e(n).data("listing")==r&&e(n).data("service")==i&&(o=e(n))});var u=e(n).data("service")+e(n).data("listing");dukt_videos_box.ajax_stack.add(u,function(){return e.ajax({url:Dukt_videos.ajax_endpoint,type:"post",data:data,beforeSend:function(){e(".dv-box .videos",o).addClass("dukt-videos-loading")},success:function(t){dukt_videos_box.ajax_stack.remove(u);e(".dv-videos-inject",o).html(t)}})})})})},add:function(e,t){dukt_log("dukt_videos_box.ajax_stack.add()",e);dukt_videos_ajax_stack[e]=t();dukt_videos_box.ajax_stack.updateStatus()},remove:function(e){dukt_log("dukt_videos_box.ajax_stack.remove()",e);for(key in dukt_videos_ajax_stack)key==e&&delete dukt_videos_ajax_stack[key];dukt_videos_box.ajax_stack.updateStatus()},updateStatus:function(){dukt_log("dukt_videos_box.ajax_stack.updateStatus()");dukt_videos_box.ajax_stack.count()>0?e(".dv-box .dv-status").addClass("dv-loading"):e(".dv-box .dv-status").removeClass("dv-loading")},count:function(){dukt_log("dukt_videos_box.ajax_stack.count()");var e=0;for(key in dukt_videos_ajax_stack)e++;return e}};dukt_videos_box.listings={reload:function(t,n,r){dukt_log("dukt_videos_box.listings.reload()",t,n,r);var i=n+t;dukt_videos_box.ajax_stack.add(i,function(){data={method:r,site_id:Dukt_videos.site_id,service:n};var s=!1;e(".dv-box .dv-listing-view").each(function(r,i){e(i).data("listing")==t&&e(i).data("service")==n&&(s=e(i))});return e.ajax({url:Dukt_videos.ajax_endpoint,type:"post",data:data,beforeSend:function(){},success:function(t){dukt_videos_box.ajax_stack.remove(i);e(".dv-videos-inject",s).html(t)}})})}};dukt_videos_box.box={init:function(t){dukt_log("dukt_videos_box.box.init()");dukt_videos_box.ajax_stack.init();dukt_videos_box.box.accounts();dukt_videos_box.box.videos();dukt_videos_box.search.init();dukt_videos_box.box.resize();e(window).resize(function(){dukt_videos_box.box.resize()});var n={lines:13,length:4,width:2,radius:4,corners:1,rotate:0,color:"#000",speed:2.2,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"7px",left:"6px"};e(".dv-box .dv-status .dv-spin").spin(n);var n={lines:13,length:4,width:2,radius:4,corners:1,rotate:0,color:"#fff",speed:2.2,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"7px",left:"6px"};e(".dv-box .dv-preview .dv-spin").spin(n);typeof t!="undefined"&&t()},resize:function(t){dukt_log("dukt_videos_box.box.resize()");typeof t=="undefined"&&(t=!1);var n=e(".dv-box").height(),r=e(window).width(),i=0,s=e(".dv-top").outerHeight(),o=e(".dv-bottom").outerHeight(),u=e(".dv-box").width()-(e(".dv-accounts").outerWidth()+e(".dv-listings").outerWidth()),a=1280,f=720,l=u*f/a;l=Math.round(l);var c=n,h=c-s-o,p=c-s-l-o,d=l*100/(l+p);if(d>60){l=60*(l+p)/100;l=Math.round(l)}p=c-s-l-o;var v=c-s-o;e(".dv-box .dv-box-in").css("height",c);e(".dv-box .dv-accounts").css("height",c);e(".dv-box .dv-listings").css("height",c);e(".dv-box .dv-preview").css("height",c);e(".dv-box .dv-preview-video, .dv-box .dv-preview-video iframe").css("height",l);e(".dv-box .dv-preview-video, .dv-box .dv-preview-video iframe").css("width",u);if(t){var m=u-200;e(".dv-box .dv-preview-video iframe").css("display","none");setTimeout(function(){e(".dv-box .dv-preview-video iframe").css("width",m);setTimeout(function(){e(".dv-box .dv-preview-video iframe").css("width",u);e(".dv-box .dv-preview-video iframe").css("display","block")},400)},100)}e(".dv-box .dv-fullscreen .dv-box .dv-preview-video, .dv-box .dv-fullscreen .dv-box .dv-preview-video iframe").css("height",v);e(".dv-box .dv-preview-inject").css("height",h);e(".dv-box .dv-preview-description").css("height",p);e(".dv-box .dv-videos").css("height",h);dukt_videos_box.lightbox.resize()}};dukt_videos_box.box.accounts=function(){dukt_log("dukt_videos_box.listings.accounts()");e(".dv-box .dv-close").live("click",function(){dukt_videos_box.lightbox.hide()});e(".dv-box .dv-accounts > ul > li > a").live("click",function(){if(e(this).parent().hasClass("selected"))return!1;var t=e(this);current_method=e(".dv-box .dv-accounts ul ul > li a.selected").data("method");e(".dv-box .dv-accounts > ul > li").removeClass("selected");e(".dv-box .dv-accounts ul ul > li a").removeClass("selected");e(this).parent().addClass("selected");method_found=!1;e(this).parent().find("ul > li a").each(function(){if(e(this).data("method")==current_method){method_found=!0;e(this).trigger("click")}});if(!method_found){e(this).parent().find("ul > li:first-child a").addClass("selected");q=e(e(".dv-box .dv-search input")[0]).attr("value");var n={method:"service_search",service:dukt_videos_box.utils.current_service(),site_id:Dukt_videos.site_id,q:q}}e(".dv-box .dv-accounts > ul > li").each(function(){t.hasClass("selected")||e(this).parent().find("ul").slideUp({easing:"easeOutCubic",duration:400})});e(this).parent().find("ul").slideDown({easing:"easeOutCubic",duration:400})});setTimeout(function(){e(".dv-box .dv-accounts ul ul > li > a").each(function(t,n){var r=e(n).data("listing"),i=e(n).data("service"),s=e(n).data("method");data={method:s,site_id:Dukt_videos.site_id,service:i};var o=!1;e(".dv-box .dv-listing-view").each(function(t,n){e(n).data("listing")==r&&e(n).data("service")==i&&(o=e(n))});var u=e(n).data("service")+e(n).data("listing");dukt_videos_box.ajax_stack.add(u,function(){return e.ajax({url:Dukt_videos.ajax_endpoint,type:"post",data:data,beforeSend:function(){e(".dv-videos",o).addClass("dv-loading")},success:function(t){dukt_videos_box.ajax_stack.remove(u);var n=e(".dv-videos-inject",o);n.html(t);e(".dv-videos",o).removeClass("dv-loading")}})})})},500);e(".dv-box .dv-accounts ul ul > li > a").live("click",function(){if(e(this).hasClass("selected")){var t=e(this).data("listing"),n=e(this).data("service"),r=e(this).data("method");dukt_videos_box.listings.reload(t,n,r)}e(".dv-box .dv-accounts ul ul > li > a").removeClass("selected");e(this).addClass("selected");var t=e(this).data("listing"),n=e(this).data("service"),r=e(this).data("method"),i=!1;e(".dv-box .dv-listing-view").css("display","none");e(".dv-box .dv-listing-view").each(function(r,s){if(e(s).data("listing")==t&&e(s).data("service")==n){i=e(s);i.css("display","block")}});return!1});e(".dv-box .dv-accounts li ul").css("display","none");e(".dv-box .dv-services > li:first-child > a").trigger("click");e(".dv-box .dv-accounts > ul > li").each(function(){if(e(this).hasClass("selected")){e(this).find("ul").slideDown({easing:"easeOutCubic",duration:400});e(this).find("ul li:first-child a").trigger("click")}})};dukt_videos_box.box.videos=function(){e(".dv-listings .dv-videos li").live("click",function(){if(e(this).hasClass("dv-videos-more"))return!1;e(".dv-preview .dv-preview-inject").html("");e(".dv-listings .dv-videos li").removeClass("selected");e(this).addClass("selected");var t={method:"box_preview",service:dukt_videos_box.utils.current_service(),site_id:Dukt_videos.site_id,video_page:e(this).data("video-page"),autoplay:1,rel:0};e(".dv-preview").data("video-page",e(this).data("video-page"));e(".dv-preview .dv-controls").css("display","block");dukt_videos_box.browser.go(t,"preview",function(){e(".dv-preview .dv-controls").css("display","block");dukt_videos_box.box.resize(!0)})});e(".dv-listings li.dv-videos-more").live("click",function(){var t=e(this),n=e(this).parent(),r=e(e(".dv-listings li.dv-videos-more").get(0)).parents(".dv-listing-view");if(e(".dv-videos-more-btn",t).css("display")!="none"){e(".dv-videos-more-btn",t).css("display","none");e(".dv-videos-more-loading",t).css("display","inline");var i=e(".dv-search input",r).attr("value"),s={action:"dukt_videos",method:e(".dv-box .dv-services > li.selected li a.selected").data("method"),service:dukt_videos_box.utils.current_service(),site_id:Dukt_videos.site_id,q:i,page:e(this).data("next-page")};e.ajax({url:Dukt_videos.ajax_endpoint,type:"post",data:s,beforeSend:function(){},success:function(e){t.remove();var r=n.html(),i=r+e;n.html(i)}})}});e(".dv-listings .dv-videos").scroll(function(t){var n=e(this).get(0).scrollHeight,r=e(this).scrollTop();scrollDifference=n-r;scrollDifference==e(this).height()&&e(".dv-videos-more",this).trigger("click")});e(".dv-preview .dv-preview-favorite").live("click",function(){favorite_enabled=!1;if(e(this).hasClass("dv-preview-favorite-selected"))e(this).removeClass("dv-preview-favorite-selected");else{e(this).addClass("dv-preview-favorite-selected");favorite_enabled=!0}var t=e(this).data("service"),n={action:"dukt_videos",method:"favorite",service:t,site_id:Dukt_videos.site_id,video_page:e(".dv-box .dv-preview").data("video-page"),favorite_enabled:favorite_enabled},r="service_favorites";e.ajax({url:Dukt_videos.ajax_endpoint,type:"post",data:n,success:function(e){dukt_videos_box.listings.reload("favorites",t,r)}})});e(".dv-box .dv-preview-fullscreen").live("click",function(){if(e(".dv-box .dv-box-in").hasClass("dv-fullscreen")){e(".dv-box .dv-box-in").removeClass("dv-fullscreen");dukt_videos_box.box.resize()}else{e(".dv-box .dv-box-in").addClass("dukt-videos-fullscreen");dukt_videos_box.box.resize()}})};dukt_videos_box.browser={current_request:[],go:function(t,n,r){dukt_log("dukt_videos_box.browser.go(data, frame, callback)",t,n,r);t.action="dukt_videos";dukt_videos_box.browser.current_request[n]=e.ajax({url:Dukt_videos.ajax_endpoint,type:"post",data:t,beforeSend:function(){e(".dv-box .dv-"+n).addClass("dv-frame-loading")},success:function(t){dukt_log("dukt_videos_box.browser.go(data, frame, callback) success");dukt_videos_box.browser.current_request[n]=!1;e(".dv-box .dv-"+n+"-inject").html(t);e(".dv-box .dv-"+n).removeClass("dv-frame-loading");e(".dv-box .dv-search").removeClass("dv-loading");dukt_videos_box.box.resize();if(dukt_videos_box.search.timer){clearTimeout(dukt_videos_box.search.timer);dukt_videos_box.search.timer=!1}typeof r=="function"&&r()}})},abort:function(e){dukt_log("dukt_videos_box.browser.abort(frame)",e);if(typeof dukt_videos_box.browser.current_request[e]!="undefined"){if(dukt_videos_box.browser.current_request[e]!=0){dukt_videos_box.browser.current_request[e].abort();dukt_videos_box.browser.current_request[e]=!1}}else dukt_videos_box.browser.current_request[e]=!1}};dukt_videos_box.search={textFocus:!1,init:function(){var t={lines:13,length:3,width:2,radius:4,corners:1,rotate:0,color:"#000",speed:2.2,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"0",left:"0"};e(".dv-listings .dv-search .dv-spin").spin(t);e(".dv-listings .dv-search-reset").live("click",function(){e(".dv-listings .dv-search input").attr("value","");e(this).css("display","none");e(".dv-listings .dv-search input").trigger("keyup")});dukt_videos_box.search.timer=!1;var n=!1;e(".dv-listings .dv-search input").live("keydown",function(e){e.keyCode==91&&(n=!0)}).live("keyup",function(t){e(".dv-accounts > ul > li.selected ul li a").removeClass("selected");e(".dv-accounts > ul > li.selected ul li:first-child a").addClass("selected");var r=e(this),i=r.attr("value");i!==""?e(".dv-listings .dv-search-reset").css("display","block"):e(".dv-listings .dv-search-reset").css("display","none");if(n==1&&t.keyCode!=91){n=!1;return!1}switch(t.keyCode){case 91:n=!1;return!1;case 18:case 16:case 37:case 38:case 39:case 40:return!1}dukt_videos_box.search.timer&&clearTimeout(dukt_videos_box.search.timer);dukt_videos_box.search.timer||e(".dv-listings .dv-search").addClass("dv-loading");var s=e(this).data("listing"),o=e(this).data("service"),u=!1;e(".dv-listings .dv-listing-view").each(function(t,n){e(n).data("listing")==s&&e(n).data("service")==o&&(u=e(n))});dukt_videos_box.search.timer=setTimeout(function(){var t={method:"service_search",service:dukt_videos_box.utils.current_service(),site_id:Dukt_videos.site_id,q:i};e.ajax({url:Dukt_videos.ajax_endpoint,type:"post",data:t,beforeSend:function(){e(".dv-listings .dv-search").addClass("dv-loading");e(".dv-videos",u).addClass("dv-loading")},success:function(t){e(".dv-videos-inject",u).html(t);e(".dv-listings .dv-search").removeClass("dv-loading");e(".dv-videos",u).removeClass("dv-loading")}})},500)})}};e(document).ready(function(){dukt_videos_box.init()})});