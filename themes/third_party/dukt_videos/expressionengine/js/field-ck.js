/**
 * Dukt Videos
 *
 * @package		Dukt Videos
 * @version		Version 1.0.2
 * @author		Benjamin David
 * @copyright	Copyright (c) 2013 - DUKT
 * @link		http://dukt.net/add-ons/expressionengine/dukt-videos/
 *
 */(function(e){e.fn.dukt_videos_field=function(t){return this.each(function(){field=e(this);e.fn.dukt_videos_field.init_field(field)})};e.fn.dukt_videos_field.current_field=!1;e.fn.dukt_videos_field.init=function(){dukt_log("field.js : ","$.fn.dukt_videos_field.init()");var t={method:"box",site_id:Dukt_videos.site_id};e.ajax({url:Dukt_videos.ajax_endpoint,type:"post",data:t,success:function(t){e("body").append(t);dukt_videos_box.box.init(function(){e(".dv-overlay").css("display")!="none"&&dukt_videos_box.lightbox.show()})}});e(".dv-cancel").live("click",function(){dukt_videos_box.lightbox.hide()});e(".dv-submit").live("click",function(){var t=e.fn.dukt_videos_field.current_field,n=e(".dv-current").data("video-url");e("input",t).attr("value",n);dukt_videos_box.lightbox.hide();e.fn.dukt_videos_field.callback_add()});typeof Matrix!="undefined"&&Matrix.bind("dukt_videos","display",function(t){if(t.row.isNew){var n=e("> .dv-field",t.dom.$td);e.fn.dukt_videos_field.init_field(n)}})};e.fn.dukt_videos_field.init_field=function(t){inputValue=e("input",t).attr("value");if(inputValue!=""){t.find(".dv-preview").html("");t.find(".dv-preview").css("display","block");t.find(".dv-preview").addClass("dv-field-preview-loading");video_page=inputValue;data={method:"field_preview",video_page:video_page,site_id:Dukt_videos.site_id};e('input[type="hidden"]',t).attr("value",video_page);e.ajax({url:Dukt_videos.ajax_endpoint,type:"post",data:data,success:function(e){t.find(".dv-preview").html(e);t.find(".dv-preview").removeClass("dv-field-preview-loading")}});e(".dv-change",t).css("display","inline-block");e(".dv-remove",t).css("display","inline-block")}else e(".dv-add",t).css("display","inline-block");e(".dv-add",t).click(function(){e.fn.dukt_videos_field.add(t)});e(".dv-change",t).click(function(){e.fn.dukt_videos_field.change(t)});e(".dv-remove",t).click(function(){e.fn.dukt_videos_field.remove(t)});e(".dv-field-embed-btn").live("click",function(){e(".dv-overlay").css("display","block");e(".dv-overlay").addClass("dv-overlay-loading");data={method:e(this).data("method"),video_page:e(this).data("video-page"),site_id:VideoPlayer.site_id};e.ajax({url:VideoPlayer.ajax_endpoint,type:"post",data:data,success:function(t){e("body").append(t);e(".dv-overlay").removeClass("dv-overlay-loading");e.fn.dukt_videos_field.lightbox.resize()}})})};e.fn.dukt_videos_field.callback_add=function(){field=e.fn.dukt_videos_field.current_field;field.find(".dv-add").css("display","none");field.find(".dv-change").css("display","inline-block");field.find(".dv-remove").css("display","inline-block");field.find(".dv-preview").html("");field.find(".dv-preview").css("display","block");field.find(".dv-preview").addClass("videoplayer-field-preview-loading");video_page=e(".dv-preview").data("video-page");data={method:"field_preview",video_page:video_page,site_id:Dukt_videos.site_id};e('input[type="hidden"]',field).attr("value",video_page);e.ajax({url:Dukt_videos.ajax_endpoint,type:"post",data:data,success:function(e){field.find(".dv-preview").html(e);field.find(".dv-preview").removeClass("dv-field-preview-loading")}})};e.fn.dukt_videos_field.add=function(t){e.fn.dukt_videos_field.current_field=t;dukt_videos_box.lightbox.show()};e.fn.dukt_videos_field.change=function(t){e.fn.dukt_videos_field.current_field=t;dukt_videos_box.lightbox.show();var n=t.find("input").attr("value"),r=e(".dv-services li.selected a.dv-service").data("service"),i={method:"box_preview",site_id:Dukt_videos.site_id,video_page:n,autoplay:0};if(e(".dv-preview").data("video-page")!=n){e(".dv-preview").data("video-page",n);dukt_videos_box.browser.go(i,"preview",function(){e(".dv-preview .dv-controls").css("display","block")})}};e.fn.dukt_videos_field.remove=function(e){e.find("input").attr("value","");e.find(".dv-add").css("display","inline-block");e.find(".dv-change").css("display","none");e.find(".dv-remove").css("display","none");e.find(".dv-preview").css("display","none")};e(document).ready(function(){e.fn.dukt_videos_field.init()})})(jQuery);$().ready(function(){$(".dv-field").dukt_videos_field()});