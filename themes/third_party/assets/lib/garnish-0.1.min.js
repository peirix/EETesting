/*!
 * Garnish UI toolkit
 *
 * @copyright 2013 Pixel & Tonic, Inc.. All rights reserved.
 * @author    Brandon Kelly <brandon@pixelandtonic.com>
 * @version   0.1
 */
(function(c){
/*!
	Base.js, version 1.1a
	Copyright 2006-2010, Dean Edwards
	License: http://www.opensource.org/licenses/mit-license.php
*/
var a=function(){};a.extend=function(f,i){var j=a.prototype.extend;a._prototyping=true;var h=new this;j.call(h,f);h.base=function(){};delete a._prototyping;var g=h.constructor;var e=h.constructor=function(){if(!a._prototyping){if(this._constructing||this.constructor==e){this._constructing=true;g.apply(this,arguments);delete this._constructing}else{if(arguments[0]!=null){return(arguments[0].extend||j).call(arguments[0],h)}}}};e.ancestor=this;e.extend=this.extend;e.forEach=this.forEach;e.implement=this.implement;e.prototype=h;e.toString=this.toString;e.valueOf=function(k){return(k=="object")?e:g.valueOf()};j.call(e,i);if(typeof e.init=="function"){e.init()}return e};a.prototype={extend:function(f,m){if(arguments.length>1){var j=this[f];if(j&&(typeof m=="function")&&(!j.valueOf||j.valueOf()!=m.valueOf())&&/\bbase\b/.test(m)){var e=m.valueOf();m=function(){var o=this.base||a.prototype.base;this.base=j;var i=e.apply(this,arguments);this.base=o;return i};m.valueOf=function(i){return(i=="object")?m:e};m.toString=a.toString}this[f]=m}else{if(f){var l=a.prototype.extend;if(!a._prototyping&&typeof this!="function"){l=this.extend||l}var h={toSource:null};var k=["constructor","toString","valueOf"];var g=a._prototyping?0:1;while(n=k[g++]){if(f[n]!=h[n]){l.call(this,n,f[n])}}for(var n in f){if(!h[n]){l.call(this,n,f[n])}}}}return this}};a=a.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(e,h,g){for(var f in e){if(this.prototype[f]===undefined){h.call(g,e[f],f,e)}}},implement:function(){for(var e=0;e<arguments.length;e++){if(typeof arguments[e]=="function"){arguments[e](this.prototype)}else{this.prototype.extend(arguments[e])}}return this},toString:function(){return String(this.valueOf())}});
/*!
 * Garnish
 */
if(typeof Garnish!="undefined"){throw"Garnish is already defined!"}var d;Garnish={$win:c(window),$doc:c(document),$bod:c(document.body),DELETE_KEY:8,SHIFT_KEY:16,CTRL_KEY:17,ALT_KEY:18,RETURN_KEY:13,ESC_KEY:27,SPACE_KEY:32,LEFT_KEY:37,UP_KEY:38,RIGHT_KEY:39,DOWN_KEY:40,A_KEY:65,CMD_KEY:91,PRIMARY_CLICK:0,SECONDARY_CLICK:2,X_AXIS:"x",Y_AXIS:"y",TEXT_NODE:3,log:function(e){if(typeof console!="undefined"&&typeof console.log=="function"){console.log(e)}},isMobileBrowser:function(){if(typeof d=="undefined"){var e=navigator.userAgent||navigator.vendor||window.opera;d=(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))}return d},isArray:function(e){return(e instanceof Array)},isJquery:function(e){return(e instanceof jQuery)},isObject:function(e){return(typeof e=="object"&&!Garnish.isArray(e)&&!Garnish.isJquery(e)&&typeof e.nodeType=="undefined")},isString:function(e){return(typeof e=="string")},isTextNode:function(e){return(e.nodeType==Garnish.TEXT_NODE)},getDist:function(f,h,e,g){return Math.sqrt(Math.pow(f-e,2)+Math.pow(h-g,2))},hitTest:function(e,g,f){Garnish.hitTest._$elem=c(f),Garnish.hitTest._offset=Garnish.hitTest._$elem.offset(),Garnish.hitTest._x1=Garnish.hitTest._offset.left,Garnish.hitTest._y1=Garnish.hitTest._offset.top,Garnish.hitTest._x2=Garnish.hitTest._x1+Garnish.hitTest._$elem.outerWidth(),Garnish.hitTest._y2=Garnish.hitTest._y1+Garnish.hitTest._$elem.outerHeight();return(e>=Garnish.hitTest._x1&&e<Garnish.hitTest._x2&&g>=Garnish.hitTest._y1&&g<Garnish.hitTest._y2)},isCursorOver:function(f,e){return Garnish.hitTest(f.pageX,f.pageY,e)},copyTextStyles:function(f,g){var h=c(f),e=c(g);e.css({lineHeight:h.css("lineHeight"),fontSize:h.css("fontSize"),fontFamily:h.css("fontFamily"),fontWeight:h.css("fontWeight"),letterSpacing:h.css("letterSpacing"),textAlign:h.css("textAlign")})},getBodyScrollTop:function(){Garnish.getBodyScrollTop._scrollTop=document.body.scrollTop;if(Garnish.getBodyScrollTop._scrollTop<0){Garnish.getBodyScrollTop._scrollTop=0}else{Garnish.getBodyScrollTop._maxScrollTop=Garnish.$bod.outerHeight()-Garnish.$win.height();if(Garnish.getBodyScrollTop._scrollTop>Garnish.getBodyScrollTop._maxScrollTop){Garnish.getBodyScrollTop._scrollTop=Garnish.getBodyScrollTop._maxScrollTop}}return Garnish.getBodyScrollTop._scrollTop},scrollContainerToElement:function(e,i){var l=c(e),f=c(i);var g=l.scrollTop(),j=f.offset().top;if(l[0]==window){var k=j-g}else{var k=j-l.offset().top}if(k<0){l.scrollTop(g+k)}else{var h=f.outerHeight(),m=(l[0]==window?window.innerHeight:l[0].clientHeight);if(k+h>m){l.scrollTop(g+(k-(m-h)))}}},SHAKE_STEPS:10,SHAKE_STEP_DURATION:25,shake:function(h,j){var e=c(h);if(!j){j="margin-left"}var g=parseInt(e.css(j));if(isNaN(g)){g=0}for(var f=0;f<=Garnish.SHAKE_STEPS;f++){(function(k){setTimeout(function(){Garnish.shake._properties={};Garnish.shake._properties[j]=g+(k%2?-1:1)*(10-k);e.animate(Garnish.shake._properties,Garnish.SHAKE_STEP_DURATION)},(Garnish.SHAKE_STEP_DURATION*k))})(f)}},getElement:function(e){return c.makeArray(e)[0]},getInputBasename:function(f){var e=c(f).attr("name");if(e){return e.replace(/\[.*/,"")}else{return null}},getInputPostVal:function(g){var e=g.attr("type"),f=g.val();if((e=="checkbox"||e=="radio")){if(g.prop("checked")){return f}else{return null}}else{if(Garnish.isArray(f)&&g.attr("name").substr(-2)!="[]"){if(f.length){return f[f.length-1]}else{return null}}else{return f}}},findInputs:function(e){return c(e).find("input,text,textarea,select,button")},getPostData:function(g){var h={},l={},e=Garnish.findInputs(g);for(var n=0;n<e.length;n++){var q=c(e[n]);var o=q.attr("name");if(!o){continue}var f=Garnish.getInputPostVal(q);if(f===null){continue}var p=(o.substr(-2)=="[]");if(p){var k=o.substring(0,o.length-2);if(typeof l[k]=="undefined"){l[k]=0}}if(!Garnish.isArray(f)){f=[f]}for(var m=0;m<f.length;m++){if(p){var o=k+"["+l[k]+"]";l[k]++}h[o]=f[m]}}return h}};Garnish.Base=a.extend({settings:null,_namespace:null,_$listeners:null,constructor:function(){this._namespace=".Garnish"+Math.floor(Math.random()*1000000000);this._$listeners=c();this.init.apply(this,arguments)},init:c.noop,setSettings:function(e,f){var g=(typeof this.settings=="undefined"?{}:this.settings);this.settings=c.extend(g,f,e)},_formatEvents:function(f){if(typeof f=="string"){f=f.split(",");for(var e=0;e<f.length;e++){f[e]=c.trim(f[e])}}for(var e=0;e<f.length;e++){f[e]+=this._namespace}return f.join(" ")},addListener:function(i,f,h){var e=c(i);f=this._formatEvents(f);if(typeof h=="function"){h=c.proxy(h,this)}else{h=c.proxy(this,h)}e.on(f,h);this._$listeners=this._$listeners.add(i);if(f.search(/\bactivate\b/)!=-1){if(!e.data("activatable")){var g=this._namespace+"-activate";e.on("mousedown"+g,function(j){j.preventDefault()});e.on("click"+g,function(k){k.preventDefault();var j=c.inArray(k.currentTarget,e),l=c(i[j]);if(!l.hasClass("disabled")){l.trigger("activate")}});e.on("keydown"+g,function(k){var j=c.inArray(k.currentTarget,e);if(j!=-1&&k.keyCode==Garnish.SPACE_KEY){k.preventDefault();var l=c(e[j]);if(!l.hasClass("disabled")){l.addClass("active");Garnish.$doc.on("keyup"+g,function(m){e.removeClass("active");if(m.keyCode==Garnish.SPACE_KEY){m.preventDefault();l.trigger("activate")}Garnish.$doc.off("keyup"+g)})}}});if(!e.hasClass("disabled")){e.attr("tabindex","0")}else{e.removeAttr("tabindex")}e.data("activatable",true)}}},removeListener:function(f,e){e=this._formatEvents(e);c(f).off(e)},removeAllListeners:function(e){c(e).off(this._namespace)},destroy:function(){this.removeAllListeners(this._$listeners)}});Garnish.BaseDrag=Garnish.Base.extend({$items:null,dragging:false,mousedownX:null,mousedownY:null,mouseDistX:null,mouseDistY:null,$targetItem:null,targetItemMouseDiffX:null,targetItemMouseDiffY:null,mouseX:null,mouseY:null,lastMouseX:null,lastMouseY:null,init:function(e,f){if(!f&&Garnish.isObject(e)){f=e;e=null}this.settings=c.extend({},Garnish.BaseDrag.defaults,f);this.$items=c();if(e){this.addItems(e)}},onMouseDown:function(f){if(f.button!=Garnish.PRIMARY_CLICK){return}if(this.$targetItem){return}if(this.settings.ignoreButtons&&f.currentTarget!=f.target){var e=c(f.target);if(e.hasClass("btn")||e.closest(".btn").length){return}}f.preventDefault();this.$targetItem=c(c.data(f.currentTarget,"drag-item"));this.mousedownX=this.mouseX=f.pageX;this.mousedownY=this.mouseY=f.pageY;var g=this.$targetItem.offset();this.targetItemMouseDiffX=f.pageX-g.left;this.targetItemMouseDiffY=f.pageY-g.top;this.addListener(Garnish.$doc,"mousemove","onMouseMove");this.addListener(Garnish.$doc,"mouseup","onMouseUp")},onMouseMove:function(e){e.preventDefault();if(this.settings.axis!=Garnish.Y_AXIS){this.mouseX=e.pageX}if(this.settings.axis!=Garnish.X_AXIS){this.mouseY=e.pageY}this.mouseDistX=this.mouseX-this.mousedownX;this.mouseDistY=this.mouseY-this.mousedownY;if(!this.dragging){this.onMouseMove._mouseDist=Garnish.getDist(this.mousedownX,this.mousedownY,this.mouseX,this.mouseY);if(this.onMouseMove._mouseDist>=Garnish.BaseDrag.minMouseDist){this.startDragging()}else{return}}this.onDrag()},onMouseUp:function(e){this.removeAllListeners(Garnish.$doc);if(this.dragging){this.stopDragging()}this.$targetItem=null},startDragging:function(){this.dragging=true;this.onDragStart()},stopDragging:function(){this.dragging=false;this.onDragStop()},onDragStart:function(){this.settings.onDragStart()},onDrag:function(){this.settings.onDrag()},onDragStop:function(){this.settings.onDragStop()},addItems:function(e){e=c.makeArray(e);for(var f=0;f<e.length;f++){var g=e[f];if(c.data(g,"drag")){Garnish.log("Element was added to more than one dragger");c.data(g,"drag").removeItems(g)}c.data(g,"drag",this);this.$items=this.$items.add(g);if(this.settings.handle){if(typeof this.settings.handle=="object"){var h=c(this.settings.handle)}else{if(typeof this.settings.handle=="string"){var h=c(g).find(this.settings.handle)}else{if(typeof this.settings.handle=="function"){var h=c(this.settings.handle(g))}}}}else{var h=c(g)}c.data(g,"drag-handle",h);h.data("drag-item",g);this.addListener(h,"mousedown","onMouseDown")}},removeItems:function(e){e=c.makeArray(e);for(var g=0;g<e.length;g++){var h=e[g];var f=c.inArray(h,this.$items);if(f!=-1){var j=c.data(h,"drag-handle");j.data("drag-item",null);c.data(h,"drag",null);c.data(h,"drag-handle",null);this.removeAllListeners(j);this.$items.splice(f,1)}}},removeAllItems:function(){for(var e=0;e<this.$items.length;e++){var f=this.$items[e],g=c.data(f,"drag-handle");c.data(f,"drag",null);if(g){c.data(f,"drag-handle",null);g.data("drag-item",null);this.removeAllListeners(g)}}this.$items=c()}},{minMouseDist:1,defaults:{handle:null,axis:null,ignoreButtons:true,onDragStart:c.noop,onDrag:c.noop,onDragStop:c.noop}});Garnish.CheckboxSelect=Garnish.Base.extend({$container:null,$all:null,$options:null,init:function(e){this.$container=c(e);if(this.$container.data("checkboxSelect")){Garnish.log("Double-instantiating a checkbox select on an element");this.$container.data("checkbox-select").destroy()}this.$container.data("checkboxSelect",this);var f=this.$container.find("input");this.$all=f.filter(".all:first");this.$options=f.not(this.$all);this.addListener(this.$all,"change","onAllChange")},onAllChange:function(){var e=this.$all.prop("checked");this.$options.attr({checked:e,disabled:e})}});Garnish.ContextMenu=Garnish.Base.extend({$target:null,options:null,$menu:null,showingMenu:false,init:function(g,e,f){this.$target=c(g);if(this.$target.data("contextmenu")){Garnish.log("Double-instantiating a context menu on an element");this.$target.data("contextmenu").destroy()}this.$target.data("contextmenu",this);this.options=e;this.setSettings(f,Garnish.ContextMenu.defaults);Garnish.ContextMenu.counter++;this.enable()},buildMenu:function(){this.$menu=c('<ul class="'+this.settings.menuClass+'" style="display: none" />');for(var e in this.options){var f=this.options[e];if(f=="-"){c('<li class="'+this.settings.optionBreakClass+'"></li>').appendTo(this.$menu)}else{var h=c("<li></li>").appendTo(this.$menu),g=c("<a>"+f.label+"</a>").appendTo(h);if(typeof f.onClick=="function"){(function(i,j){setTimeout(c.proxy(function(){i.mousedown(c.proxy(function(k){this.hideMenu();j.call(this.currentTarget,c.extend(k,{currentTarget:this.currentTarget}))},this))},this),1)}).call(this,g,f.onClick)}}}},showMenu:function(e){if(e.type=="mousedown"&&e.button!=Garnish.SECONDARY_CLICK){return}if(e.type=="contextmenu"){e.preventDefault()}if(this.showing&&e.currentTarget==this.currentTarget){return}this.currentTarget=e.currentTarget;if(!this.$menu){this.buildMenu()}this.$menu.appendTo(document.body);this.$menu.show();this.$menu.css({left:e.pageX+1,top:e.pageY-4});this.showing=true;setTimeout(c.proxy(function(){this.addListener(Garnish.$doc,"mousedown","hideMenu")},this),0)},hideMenu:function(){this.removeListener(Garnish.$doc,"mousedown");this.$menu.hide();this.showing=false},enable:function(){this.addListener(this.$target,"contextmenu,mousedown","showMenu")},disable:function(){this.removeListener(this.$target,"contextmenu,mousedown")}},{defaults:{menuClass:"contextmenu",optionBreakClass:"contextmenu-break",},counter:0});Garnish.Drag=Garnish.BaseDrag.extend({$draggee:null,otherItems:null,totalOtherItems:null,helpers:null,helperTargets:null,helperPositions:null,helperLagIncrement:null,updateHelperPosInterval:null,init:function(e,f){if(!f&&Garnish.isObject(e)){f=e;e=null}f=c.extend({},Garnish.Drag.defaults,f);this.base(e,f)},onDragStart:function(){this.helpers=[];this.helperTargets=[];this.helperPositions=[];this.getDraggee();this.draggeeIndex=c.inArray(this.$draggee[0],this.$items);this.draggeeDisplay=this.$draggee.css("display");this.createHelpers();if(this.settings.removeDraggee){this.$draggee.hide()}else{this.$draggee.css("visibility","hidden")}this.lastMouseX=this.lastMouseY=null;this.otherItems=[];for(var e=0;e<this.$items.length;e++){var f=this.$items[e];if(c.inArray(f,this.$draggee)==-1){this.otherItems.push(f)}}this.totalOtherItems=this.otherItems.length;this.helperLagIncrement=this.helpers.length==1?0:Garnish.Drag.helperLagIncrementDividend/(this.helpers.length-1);this.updateHelperPosInterval=setInterval(c.proxy(this,"updateHelperPos"),Garnish.Drag.updateHelperPosInterval);this.base()},onDragStop:function(){clearInterval(this.updateHelperPosInterval);this.base()},getDraggee:function(){switch(typeof this.settings.filter){case"function":this.$draggee=this.settings.filter();break;case"string":this.$draggee=this.$items.filter(this.settings.filter);break;default:this.$draggee=this.$targetItem}this.$draggee=c([this.$targetItem[0]].concat(this.$draggee.not(this.$targetItem[0]).toArray()))},createHelpers:function(){for(var f=0;f<this.$draggee.length;f++){var h=c(this.$draggee[f]),g=h.clone();g.css({width:h.width(),height:h.height(),margin:0});if(typeof this.settings.helper=="function"){g=this.settings.helper(g)}else{if(this.settings.helper){g=c(this.settings.helper).append(g)}}g.appendTo(Garnish.$bod);var e=this.getHelperTarget(f);g.css({position:"absolute",top:e.top,left:e.left,zIndex:Garnish.Drag.helperZindex+this.$draggee.length-f,opacity:this.settings.helperOpacity});this.helperPositions[f]={top:e.top,left:e.left};this.helpers.push(g)}},getHelperTarget:function(e){return{left:this.mouseX-this.targetItemMouseDiffX+(e*Garnish.Drag.helperSpacingX),top:this.mouseY-this.targetItemMouseDiffY+(e*Garnish.Drag.helperSpacingY)}},updateHelperPos:function(){if(this.mouseX!==this.lastMouseX||this.mouseY!==this.lastMouseY){for(this.updateHelperPos._i=0;this.updateHelperPos._i<this.helpers.length;this.updateHelperPos._i++){this.helperTargets[this.updateHelperPos._i]=this.getHelperTarget(this.updateHelperPos._i)}this.lastMouseX=this.mouseX;this.lastMouseY=this.mouseY}for(this.updateHelperPos._j=0;this.updateHelperPos._j<this.helpers.length;this.updateHelperPos._j++){this.updateHelperPos._lag=Garnish.Drag.helperLagBase+(this.helperLagIncrement*this.updateHelperPos._j);this.helperPositions[this.updateHelperPos._j]={left:this.helperPositions[this.updateHelperPos._j].left+((this.helperTargets[this.updateHelperPos._j].left-this.helperPositions[this.updateHelperPos._j].left)/this.updateHelperPos._lag),top:this.helperPositions[this.updateHelperPos._j].top+((this.helperTargets[this.updateHelperPos._j].top-this.helperPositions[this.updateHelperPos._j].top)/this.updateHelperPos._lag)};this.helpers[this.updateHelperPos._j].css(this.helperPositions[this.updateHelperPos._j])}},returnHelpersToDraggees:function(){for(var e=0;e<this.$draggee.length;e++){var h=c(this.$draggee[e]),g=this.helpers[e],f=h.offset();(function(j,i){i.animate({left:f.left,top:f.top},"fast",function(){j.css("visibility","visible");i.remove()})})(h,g)}}},{helperZindex:1000,helperLagBase:1,helperLagIncrementDividend:1.5,updateHelperPosInterval:20,helperSpacingX:5,helperSpacingY:5,defaults:{removeDraggee:false,helperOpacity:1,helper:null}});Garnish.DragDrop=Garnish.Drag.extend({$dropTargets:null,$activeDropTarget:null,init:function(e){e=c.extend({},Garnish.DragDrop.defaults,e);this.base(e)},onDragStart:function(){if(this.settings.dropTargets){if(typeof this.settings.dropTargets=="function"){this.$dropTargets=c(this.settings.dropTargets())}else{this.$dropTargets=c(this.settings.dropTargets)}if(!this.$dropTargets.length){this.$dropTargets=null}}this.$activeDropTarget=null;this.base()},onDrag:function(){if(this.$dropTargets){this.onDrag._activeDropTarget=null;for(this.onDrag._i=0;this.onDrag._i<this.$dropTargets.length;this.onDrag._i++){this.onDrag._elem=this.$dropTargets[this.onDrag._i];if(Garnish.hitTest(this.mouseX,this.mouseY,this.onDrag._elem)){this.onDrag._activeDropTarget=this.onDrag._elem;break}}if((this.$activeDropTarget&&this.onDrag._activeDropTarget!=this.$activeDropTarget[0])||(!this.$activeDropTarget&&this.onDrag._activeDropTarget!==null)){if(this.$activeDropTarget){this.$activeDropTarget.removeClass(this.settings.activeDropTargetClass)}if(this.onDrag._activeDropTarget){this.$activeDropTarget=c(this.onDrag._activeDropTarget).addClass(this.settings.activeDropTargetClass)}else{this.$activeDropTarget=null}this.settings.onDropTargetChange(this.$activeDropTarget)}}this.base()},onDragStop:function(){if(this.$dropTargets&&this.$activeDropTarget){this.$activeDropTarget.removeClass(this.settings.activeDropTargetClass)}this.base()},fadeOutHelpers:function(){for(var e=0;e<this.helpers.length;e++){(function(f){f.fadeOut("fast",function(){f.remove()})})(this.helpers[e])}}},{defaults:{dropTargets:null,onDropTargetChange:c.noop,activeDropTargetClass:"active"}});Garnish.DragMove=Garnish.BaseDrag.extend({onDrag:function(e,f){this.$targetItem.css({left:this.mouseX-this.targetItemMouseDiffX,top:this.mouseY-this.targetItemMouseDiffY})}});Garnish.DragSort=Garnish.Drag.extend({$heightedContainer:null,$insertion:null,$caboose:null,startDraggeeIndex:null,closestItem:null,init:function(e,f){if(!f&&Garnish.isObject(e)){f=e;e=null}f=c.extend({},Garnish.DragSort.defaults,f);this.base(e,f);if(this.settings.caboose){if(typeof this.settings.caboose=="function"){this.$caboose=c(this.settings.caboose())}else{this.$caboose=c(this.settings.caboose)}}},onDragStart:function(){this.base();if(this.settings.container&&this.$caboose){this.$caboose.appendTo(this.settings.container);this.otherItems.push(this.$caboose[0]);this.totalOtherItems++}this.closestItem=null;this.setMidpoints();this.setInsertion();if(this.settings.container){this.$heightedContainer=c(this.settings.container);while(!this.$heightedContainer.height()){this.$heightedContainer=this.$heightedContainer.parent()}}this.startDraggeeIndex=this.draggeeIndex},setInsertion:function(){if(this.settings.insertion){if(typeof this.settings.insertion=="function"){this.$insertion=c(this.settings.insertion(this.$draggee))}else{this.$insertion=c(this.settings.insertion)}}},setMidpoints:function(){for(var f=0;f<this.totalOtherItems;f++){var e=c(this.otherItems[f]),g=e.offset();e.data("midpoint",{left:g.left+e.outerWidth()/2,top:g.top+e.outerHeight()/2})}},onDrag:function(){if(this.$heightedContainer&&!Garnish.hitTest(this.mouseX,this.mouseY,this.$heightedContainer)){if(this.closestItem){this.closestItem=null;if(this.$insertion){this.$insertion.remove()}}}else{if(this.closestItem!=(this.closestItem=this.getClosestItem())){this.onInsertionPointChange()}}this.base()},getClosestItem:function(){this.getClosestItem._closestItem=null;this.getClosestItem._closestItemMouseDiff=null;for(this.getClosestItem._i=0;this.getClosestItem._i<this.totalOtherItems;this.getClosestItem._i++){this.getClosestItem._$item=c(this.otherItems[this.getClosestItem._i]);this.getClosestItem._midpoint=this.getClosestItem._$item.data("midpoint");this.getClosestItem._mouseDiff=Garnish.getDist(this.getClosestItem._midpoint.left,this.getClosestItem._midpoint.top,this.mouseX,this.mouseY);if(this.getClosestItem._closestItem===null||this.getClosestItem._mouseDiff<this.getClosestItem._closestItemMouseDiff){this.getClosestItem._closestItem=this.getClosestItem._$item[0];this.getClosestItem._closestItemMouseDiff=this.getClosestItem._mouseDiff}}return this.getClosestItem._closestItem},onInsertionPointChange:function(){if(this.closestItem){this.$draggee.insertBefore(this.closestItem);if(this.$insertion){this.$insertion.insertBefore(this.closestItem)}}this.settings.onInsertionPointChange()},onDragStop:function(){if(this.$caboose){this.$caboose.remove()}if(this.$insertion){this.$insertion.remove()}this.$draggee.css({display:this.draggeeDisplay,visibility:"hidden"});this.returnHelpersToDraggees();this.base();this.$items=c().add(this.$items);var e=c.inArray(this.$draggee[0],this.$items);if(this.startDraggeeIndex!=e){this.settings.onSortChange()}}},{defaults:{container:null,insertion:null,onInsertionPointChange:c.noop,onSortChange:c.noop}});Garnish.HUD=Garnish.Base.extend({init:function(e,g,f){this.$trigger=c(e);this.setSettings(f,Garnish.HUD.defaults);this.showing=false;this.$hud=c('<div class="'+this.settings.hudClass+'" />').appendTo(Garnish.$bod);this.$tip=c('<div class="'+this.settings.tipClass+'" />').appendTo(this.$hud);this.$contents=c('<div class="'+this.settings.contentsClass+'" />').appendTo(this.$hud).html(g);this.show();this.addListener(this.$hud,"click",function(h){h.stopPropagation()})},show:function(g){if(this.showing){return}if(Garnish.HUD.active){Garnish.HUD.active.hide()}this.$hud.show();this.windowWidth=Garnish.$win.width();this.windowHeight=Garnish.$win.height();this.windowScrollLeft=Garnish.$win.scrollLeft();this.windowScrollTop=Garnish.$win.scrollTop();this.triggerWidth=this.$trigger.outerWidth();this.triggerHeight=this.$trigger.outerHeight();this.triggerOffset=this.$trigger.offset();this.triggerOffsetRight=this.triggerOffset.left+this.triggerWidth;this.triggerOffsetBottom=this.triggerOffset.top+this.triggerHeight;this.triggerOffsetLeft=this.triggerOffset.left;this.triggerOffsetTop=this.triggerOffset.top;this.width=this.$hud.width();this.height=this.$hud.height();this.minHorizontalClearance=this.width+this.settings.triggerSpacing+this.settings.windowSpacing;this.minVerticalClearance=this.height+this.settings.triggerSpacing+this.settings.windowSpacing;this.rightClearance=this.windowWidth+this.windowScrollLeft-this.triggerOffsetRight;this.bottomClearance=this.windowHeight+this.windowScrollTop-this.triggerOffsetBottom;this.leftClearance=this.triggerOffsetLeft-this.windowScrollLeft;this.topClearance=this.triggerOffsetTop-this.windowScrollTop;if(this.bottomClearance>=this.minVerticalClearance){var j=this.triggerOffsetBottom+this.settings.triggerSpacing;this.$hud.css("top",j);this._setLeftPos();this._setTipClass("top")}else{if(this.rightClearance>=this.minHorizontalClearance){var i=this.triggerOffsetRight+this.settings.triggerSpacing;this.$hud.css("left",i);this._setTopPos();this._setTipClass("left")}else{if(this.leftClearance>=this.minHorizontalClearance){var i=this.triggerOffsetLeft-(this.width+this.settings.triggerSpacing);this.$hud.css("left",i);this._setTopPos();this._setTipClass("right")}else{if(this.topClearance>=this.minVerticalClearance){var j=this.triggerOffsetTop-(this.height+this.settings.triggerSpacing);this.$hud.css("top",j);this._setLeftPos();this._setTipClass("bottom")}else{var f=this.minHorizontalClearance-this.rightClearance,h=this.minVerticalClearance-this.bottomClearance;if(f>=h){var i=this.windowWidth-(this.width+this.settings.windowSpacing),e=this.triggerOffsetLeft+this.settings.triggerSpacing;if(i<e){i=e}this.$hud.css("left",i);this._setTopPos();this._setTipClass("left")}else{var j=this.windowHeight-(this.height+this.settings.windowSpacing),k=this.triggerOffsetTop+this.settings.triggerSpacing;if(j<k){j=k}this.$hud.css("top",j);this._setLeftPos();this._setTipClass("top")}}}}}if(g&&g.stopPropagation){g.stopPropagation()}this.addListener(Garnish.$bod,"click","hide");if(this.settings.closeBtn){this.addListener(this.settings.closeBtn,"activate","hide")}this.showing=true;Garnish.HUD.active=this;this.settings.onShow()},_setTopPos:function(){var h=(this.windowHeight+this.windowScrollTop)-(this.height+this.settings.windowSpacing),i=(this.windowScrollTop+this.settings.windowSpacing),e=this.triggerOffsetTop+Math.round(this.triggerHeight/2),g=e-Math.round(this.height/2);if(g>h){g=h}if(g<i){g=i}this.$hud.css("top",g);var f=(e-g)-(this.settings.tipWidth/2);this.$tip.css({top:f,left:""})},_setLeftPos:function(){var g=(this.windowWidth+this.windowScrollLeft)-(this.width+this.settings.windowSpacing),f=(this.windowScrollLeft+this.settings.windowSpacing),h=this.triggerOffsetLeft+Math.round(this.triggerWidth/2),i=h-Math.round(this.width/2);if(i>g){i=g}if(i<f){i=f}this.$hud.css("left",i);var e=(h-i)-(this.settings.tipWidth/2);this.$tip.css({left:e,top:""})},_setTipClass:function(e){if(this.tipClass){this.$tip.removeClass(this.tipClass)}this.tipClass=this.settings.tipClass+"-"+e;this.$tip.addClass(this.tipClass)},hide:function(){this.$hud.hide();this.showing=false;Garnish.HUD.active=null;this.settings.onHide()}},{defaults:{hudClass:"hud",tipClass:"tip",contentsClass:"contents",triggerSpacing:7,windowSpacing:20,tipWidth:8,onShow:c.noop,onHide:c.noop,closeBtn:null}});Garnish.LightSwitch=Garnish.Base.extend({settings:null,$outerContainer:null,$innerContainer:null,$input:null,$toggleTarget:null,on:null,dragger:null,dragStartMargin:null,init:function(e,f){this.$outerContainer=c(e);if(this.$outerContainer.data("lightswitch")){Garnish.log("Double-instantiating a switch on an element");this.$outerContainer.data("lightswitch").destroy()}this.$outerContainer.data("lightswitch",this);this.setSettings(f,Garnish.LightSwitch.defaults);this.$innerContainer=this.$outerContainer.find(".container:first");this.$input=this.$outerContainer.find("input:first");this.$toggleTarget=c(this.$outerContainer.attr("data-toggle"));this.on=this.$outerContainer.hasClass("on");this.addListener(this.$outerContainer,"mousedown","_onMouseDown");this.addListener(this.$outerContainer,"keydown","_onKeyDown");this.dragger=new Garnish.BaseDrag(this.$outerContainer,{axis:Garnish.X_AXIS,ignoreButtons:false,onDragStart:c.proxy(this,"_onDragStart"),onDrag:c.proxy(this,"_onDrag"),onDragStop:c.proxy(this,"_onDragStop")})},turnOn:function(){this.$innerContainer.stop().animate({marginLeft:0},"fast");this.$input.val(Garnish.Y_AXIS);this.on=true;this.settings.onChange();this.$toggleTarget.show();this.$toggleTarget.height("auto");var e=this.$toggleTarget.height();this.$toggleTarget.height(0);this.$toggleTarget.stop().animate({height:e},"fast",c.proxy(function(){this.$toggleTarget.height("auto")},this))},turnOff:function(){this.$innerContainer.stop().animate({marginLeft:Garnish.LightSwitch.offMargin},"fast");this.$input.val("");this.on=false;this.settings.onChange();this.$toggleTarget.stop().animate({height:0},"fast")},toggle:function(e){if(!this.on){this.turnOn()}else{this.turnOff()}},_onMouseDown:function(){this.addListener(Garnish.$doc,"mouseup","_onMouseUp")},_onMouseUp:function(){this.removeListener(Garnish.$doc,"mouseup");if(!this.dragger.dragging){this.toggle()}},_onKeyDown:function(e){switch(e.keyCode){case Garnish.SPACE_KEY:this.toggle();e.preventDefault();break;case Garnish.RIGHT_KEY:this.turnOn();e.preventDefault();break;case Garnish.LEFT_KEY:this.turnOff();e.preventDefault();break}},_getMargin:function(){return parseInt(this.$innerContainer.css("marginLeft"))},_onDragStart:function(){this.dragStartMargin=this._getMargin()},_onDrag:function(){var e=this.dragStartMargin+this.dragger.mouseDistX;if(e<Garnish.LightSwitch.offMargin){e=Garnish.LightSwitch.offMargin}else{if(e>0){e=0}}this.$innerContainer.css("marginLeft",e)},_onDragStop:function(){var e=this._getMargin();if(e>-16){this.turnOn()}else{this.turnOff()}},destroy:function(){this.base();this.dragger.destroy()}},{offMargin:-50,defaults:{onChange:c.noop}});Garnish.Menu=Garnish.Base.extend({settings:null,$container:null,$options:null,$btn:null,init:function(e,f){this.setSettings(f,Garnish.Menu.defaults);this.$container=c(e).appendTo(Garnish.$bod);this.$options=this.$container.find("a");this.$options.data("menu",this);if(this.settings.attachToButton){this.$btn=c(this.settings.attachToButton)}this.addListener(this.$options,"mousedown","selectOption")},setPositionRelativeToButton:function(){var g=this.$btn.offset(),f=this.$btn.outerWidth(),e={top:g.top+this.$btn.outerHeight(),minWidth:(f-32)};if(this.$container.attr("data-align")=="right"){e.right=1+Garnish.$win.width()-(g.left+f)}else{e.left=1+g.left}this.$container.css(e)},show:function(){if(this.$btn){this.setPositionRelativeToButton()}this.$container.fadeIn(50)},hide:function(){this.$container.fadeOut("fast")},selectOption:function(e){this.settings.onOptionSelect(e.currentTarget)}},{defaults:{attachToButton:null,onOptionSelect:c.noop}});Garnish.MenuBtn=Garnish.Base.extend({$btn:null,menu:null,showingMenu:false,init:function(e,g){this.$btn=c(e);if(this.$btn.data("menubtn")){Garnish.log("Double-instantiating a menu button on an element");this.$btn.data("menubtn").destroy()}this.$btn.data("menubtn",this);this.setSettings(g,Garnish.MenuBtn.defaults);var f=this.$btn.next(".menu");this.menu=new Garnish.Menu(f,{attachToButton:this.$btn,onOptionSelect:c.proxy(this,"onOptionSelect")});this.addListener(this.$btn,"mousedown","onMouseDown")},onMouseDown:function(e){if(e.button!=Garnish.PRIMARY_CLICK||e.metaKey){return}e.preventDefault();if(this.showingMenu){this.hideMenu()}else{this.showMenu()}},showMenu:function(){this.menu.show();this.$btn.addClass("active");this.showingMenu=true;setTimeout(c.proxy(function(){this.addListener(Garnish.$doc,"mousedown","onMouseDown")},this),1);if(!Garnish.isMobileBrowser()){this.addListener(Garnish.$win,"resize","hideMenu")}},hideMenu:function(){this.menu.hide();this.$btn.removeClass("active");this.showingMenu=false;this.removeListener(Garnish.$doc,"mousedown");if(!Garnish.isMobileBrowser()){this.removeListener(Garnish.$doc,"resize")}},onOptionSelect:function(e){this.settings.onOptionSelect(e)}},{defaults:{onOptionSelect:c.noop}});Garnish.MixedInput=Garnish.Base.extend({$container:null,elements:null,focussedElement:null,blurTimeout:null,init:function(e,f){this.$container=c(e);this.setSettings(f,Garnish.MixedInput.defaults);this.elements=[];this.$container.attr("tabindex",0);this.addListener(this.$container,"focus","onFocus")},getElementIndex:function(e){return c.inArray(e,this.elements)},isText:function(e){return(e.prop("nodeName")=="INPUT")},onFocus:function(f){if(this.elements.length){var e=this.elements[0];this.setFocus(e);this.setCarotPos(e,0)}else{this.addTextElement()}},addTextElement:function(e){var f=new b(this);this.addElement(f.$input,e);return f},addElement:function(e,i){if(typeof i=="undefined"){if(this.focussedElement){var l=this.focussedElement,j=this.getElementIndex(l);if(this.isText(l)){var m=l.prop("selectionStart"),n=l.prop("selectionEnd"),f=l.val(),g=f.substring(0,m),k=f.substr(n);if(g&&k){l.val(g).trigger("change");var h=new b(this);h.$input.val(k).trigger("change");this.addElement(h.$input,j+1);i=j+1}else{if(!g){i=j}else{i=j+1}}}else{i=j+1}}else{i=this.elements.length}}if(typeof this.elements[i]!="undefined"){e.insertBefore(this.elements[i]);this.elements.splice(i,0,e)}else{i=this.elements.length;this.$container.append(e);this.elements.push(e)}if(!this.isText(e)){if(i==0||!this.isText(this.elements[i-1])){this.addTextElement(i);i++}if(i==this.elements.length-1||!this.isText(this.elements[i+1])){this.addTextElement(i+1)}}this.addListener(e,"click",function(){this.setFocus(e)});setTimeout(c.proxy(function(){this.setFocus(e)},this),1)},removeElement:function(e){var g=this.getElementIndex(e);if(g!=-1){this.elements.splice(g,1);if(!this.isText(e)){var j=this.elements[g-1],h=this.elements[g];if(this.isText(j)&&this.isText(h)){var i=j.val(),f=i+h.val();j.val(f).trigger("change");this.removeElement(h);this.setFocus(j);this.setCarotPos(j,i.length)}}e.remove()}},setFocus:function(e){this.$container.addClass("focus");if(!this.focussedElement){this.$container.attr("tabindex","-1")}else{this.blurFocussedElement()}e.attr("tabindex","0");e.focus();this.focussedElement=e;this.addListener(e,"blur",function(){this.blurTimeout=setTimeout(c.proxy(function(){if(this.focussedElement==e){this.blurFocussedElement();this.focussedElement=null;this.$container.removeClass("focus");this.$container.attr("tabindex","0")}},this),1)})},blurFocussedElement:function(){this.removeListener(this.focussedElement,"blur");this.focussedElement.attr("tabindex","-1")},focusPreviousElement:function(h){var f=this.getElementIndex(h);if(f>0){var e=this.elements[f-1];this.setFocus(e);if(this.isText(e)){var g=e.val().length;this.setCarotPos(e,g)}}},focusNextElement:function(g){var f=this.getElementIndex(g);if(f<this.elements.length-1){var e=this.elements[f+1];this.setFocus(e);if(this.isText(e)){this.setCarotPos(e,0)}}},setCarotPos:function(e,f){e.prop("selectionStart",f);e.prop("selectionEnd",f)}});var b=Garnish.Base.extend({parentInput:null,$input:null,$stage:null,val:null,focussed:false,interval:null,init:function(e){this.parentInput=e;this.$input=c('<input type="text"/>').appendTo(this.parentInput.$container);this.$input.css("margin-right",(2-b.padding)+"px");this.setWidth();this.addListener(this.$input,"focus","onFocus");this.addListener(this.$input,"blur","onBlur");this.addListener(this.$input,"keydown","onKeyDown");this.addListener(this.$input,"change","checkInput")},getIndex:function(){return this.parentInput.getElementIndex(this.$input)},buildStage:function(){this.$stage=c("<stage/>").appendTo(Garnish.$bod);this.$stage.css({position:"absolute",top:-9999,left:-9999,wordWrap:"nowrap"});Garnish.copyTextStyles(this.$input,this.$stage)},getTextWidth:function(e){if(!this.$stage){this.buildStage()}if(e){e=e.replace(/&/g,"&amp;");e=e.replace(/</g,"&lt;");e=e.replace(/>/g,"&gt;");e=e.replace(/ /g,"&nbsp;")}this.$stage.html(e);this.stageWidth=this.$stage.width();return this.stageWidth},onFocus:function(){this.focussed=true;this.interval=setInterval(c.proxy(this,"checkInput"),Garnish.NiceText.interval);this.checkInput()},onBlur:function(){this.focussed=false;clearInterval(this.interval);this.checkInput()},onKeyDown:function(e){setTimeout(c.proxy(this,"checkInput"),1);switch(e.keyCode){case Garnish.LEFT_KEY:if(this.$input.prop("selectionStart")==0&&this.$input.prop("selectionEnd")==0){this.parentInput.focusPreviousElement(this.$input)}break;case Garnish.RIGHT_KEY:if(this.$input.prop("selectionStart")==this.val.length&&this.$input.prop("selectionEnd")==this.val.length){this.parentInput.focusNextElement(this.$input)}break;case Garnish.DELETE_KEY:if(this.$input.prop("selectionStart")==0&&this.$input.prop("selectionEnd")==0){this.parentInput.focusPreviousElement(this.$input);e.preventDefault()}}},getVal:function(){this.val=this.$input.val();return this.val},setVal:function(e){this.$input.val(e);this.checkInput()},checkInput:function(){var e=(this.val!==this.getVal());if(e){this.setWidth();this.onChange()}return e},setWidth:function(){if(this.stageWidth!==this.getTextWidth(this.val)){var e=this.stageWidth+b.padding;this.$input.width(e)}},onChange:c.noop},{padding:20});Garnish.Modal=Garnish.Base.extend({$container:null,$header:null,$body:null,$scrollpane:null,$footer:null,$footerBtns:null,$submitBtn:null,_headerHeight:null,_footerHeight:null,visible:false,dragger:null,init:function(e,f){if(!f&&Garnish.isObject(e)){f=e;items=null}this.setSettings(f,Garnish.Modal.defaults);if(e){this.setContainer(e);this.show()}Garnish.Modal.instances.push(this)},setContainer:function(e){this.$container=c(e);if(this.$container.data("modal")){Garnish.log("Double-instantiating a modal on an element");this.$container.data("modal").destroy()}this.$container.data("modal",this);this.$header=this.$container.find(".pane-head:first");this.$body=this.$container.find(".pane-body:first");this.$scrollpane=this.$body.children(".scrollpane:first");this.$footer=this.$container.find(".pane-foot:first");this.$footerBtns=this.$footer.find(".btn");this.$submitBtn=this.$footerBtns.filter(".submit:first");this.$closeBtn=this.$footerBtns.filter(".close:first");if(this.settings.draggable){var f=this.$header.add(this.$footer);if(f.length){this.dragger=new Garnish.DragMove(this.$container,{handle:this.$container})}}this.addListener(this.$container,"keydown","onKeyDown");this.addListener(this.$closeBtn,"click","hide")},show:function(){if(Garnish.Modal.visibleModal){Garnish.Modal.visibleModal.hide()}if(this.$container){this.$container.show();var e=this.getHeight();this.$container.css("margin-top",-Math.round(e/2));var f=Garnish.$win.width();if(this.$container.width()>f){this.$container.css({width:f,marginLeft:-Math.round(f/2)})}this.$container.delay(50).fadeIn()}this.visible=true;Garnish.Modal.visibleModal=this;Garnish.Modal.$shade.fadeIn(50);this.addListener(Garnish.Modal.$shade,"click","hide")},hide:function(){if(this.$container){this.$container.fadeOut("fast");this.removeListener(Garnish.$win,"resize")}this.visible=false;Garnish.Modal.visibleModal=null;Garnish.Modal.$shade.fadeOut("fast");this.removeListener(Garnish.Modal.$shade,"click")},getHeight:function(){if(!this.$container){throw"Attempted to get the height of a modal whose container has not been set."}if(!this.visible){this.$container.show()}var e=this.$container.outerHeight();if(!this.visible){this.$container.hide()}return e},getWidth:function(){if(!this.$container){throw"Attempted to get the width of a modal whose container has not been set."}if(!this.visible){this.$container.show()}var e=this.$container.outerWidth();if(!this.visible){this.$container.hide()}return e},positionRelativeTo:function(i){if(!this.$container){throw"Attempted to position a modal whose container has not been set."}var f=c(i),k=f.offset(),h=Garnish.$bod.scrollTop(),g=k.top-h,e=this.getHeight();if(e<g+Garnish.navHeight+Garnish.Modal.relativeElemPadding*2){var j=k.top-e-Garnish.Modal.relativeElemPadding}else{var j=k.top+f.height()+Garnish.Modal.relativeElemPadding}this.$container.css({top:j,left:k.left})},onKeyDown:function(e){if(e.target.nodeName!="TEXTAREA"&&e.keyCode==Garnish.RETURN_KEY){this.$submitBtn.click()}},destroy:function(){this.base();if(this.dragger){this.dragger.destroy()}}},{relativeElemPadding:8,defaults:{draggable:true},instances:[],visibleModal:null,$shade:c('<div class="modal-shade"/>').appendTo(Garnish.$bod)});Garnish.NiceText=Garnish.Base.extend({$input:null,$hint:null,$stage:null,autoHeight:null,focussed:false,showingHint:false,val:null,stageHeight:null,minHeight:null,interval:null,init:function(e,f){this.$input=c(e);this.settings=c.extend({},Garnish.NiceText.defaults,f);if(this.$input.data("nicetext")){Garnish.log("Double-instantiating a transparent text input on an element");this.$input.data("nicetext").destroy()}this.$input.data("nicetext",this);this.getVal();this.autoHeight=(this.settings.autoHeight&&this.$input.prop("nodeName")=="TEXTAREA");if(this.autoHeight){this.minHeight=this.getStageHeight("");this.setHeight();this.addListener(Garnish.$win,"resize","setHeight")}if(this.settings.hint){this.$hintContainer=c('<div class="texthint-container"/>').insertBefore(this.$input);this.$hint=c('<div class="texthint">'+this.settings.hint+"</div>").appendTo(this.$hintContainer);this.$hint.css({top:(parseInt(this.$input.css("borderTopWidth"))+parseInt(this.$input.css("paddingTop"))),left:(parseInt(this.$input.css("borderLeftWidth"))+parseInt(this.$input.css("paddingLeft"))+1)});Garnish.copyTextStyles(this.$input,this.$hint);if(this.val){this.$hint.hide()}else{this.showingHint=true}this.addListener(this.$hint,"mousedown",function(g){g.preventDefault();this.$input.focus()})}this.addListener(this.$input,"focus","onFocus");this.addListener(this.$input,"blur","onBlur");this.addListener(this.$input,"keydown","onKeyDown")},getVal:function(){this.val=this.$input.val();return this.val},showHint:function(){this.$hint.fadeIn(Garnish.NiceText.hintFadeDuration);this.showingHint=true},hideHint:function(){this.$hint.fadeOut(Garnish.NiceText.hintFadeDuration);this.showingHint=false},checkInput:function(){var e=(this.val!==this.getVal());if(e){if(this.$hint){if(this.showingHint&&this.val){this.hideHint()}else{if(!this.showingHint&&!this.val){this.showHint()}}}if(this.autoHeight){this.setHeight()}}return e},buildStage:function(){this.$stage=c("<stage/>").appendTo(Garnish.$bod);this.$stage.css({position:"absolute",top:-9999,left:-9999,wordWrap:"break-word"});Garnish.copyTextStyles(this.$input,this.$stage)},getStageHeight:function(f){if(!this.$stage){this.buildStage()}this.$stage.css("width",this.$input.width());if(!f){f="&nbsp;";for(var e=1;e<this.$input.prop("rows");e++){f+="<br/>&nbsp;"}}else{f=f.replace(/&/g,"&amp;");f=f.replace(/</g,"&lt;");f=f.replace(/>/g,"&gt;");f=f.replace(/ /g,"&nbsp;");f=f.replace(/[\n\r]$/g,"<br/>&nbsp;");f=f.replace(/[\n\r]/g,"<br/>");f+="<br/>&nbsp;"}this.$stage.html(f);this.stageHeight=this.$stage.height();return this.stageHeight},setHeight:function(){if(this.stageHeight!==this.getStageHeight(this.val)){var e=this.stageHeight;if(e<this.minHeight){e=this.minHeight}this.$input.height(e)}},onFocus:function(){this.focussed=true;this.interval=setInterval(c.proxy(this,"checkInput"),Garnish.NiceText.interval);this.checkInput()},onBlur:function(){this.focussed=false;clearInterval(this.interval);this.checkInput()},onKeyDown:function(){setTimeout(c.proxy(this,"checkInput"),1)},destroy:function(){this.base();this.$hint.remove();this.$stage.remove()}},{interval:100,hintFadeDuration:50,defaults:{autoHeight:true}});Garnish.PasswordInput=Garnish.Base.extend({$passwordInput:null,$textInput:null,$currentInput:null,$showPasswordToggle:null,showingPassword:null,showingCapsIcon:null,init:function(e){this.$passwordInput=c(e);if(this.$passwordInput.data("passwordInput")){Garnish.log("Double-instantiating a password input on an element");this.$passwordInput.data("passwordInput").destroy()}this.$passwordInput.data("passwordInput",this);this.showingCapsIcon=false;this.$showPasswordToggle=c("<a/>").hide();this.$showPasswordToggle.addClass("password-toggle");this.$showPasswordToggle.insertAfter(this.$passwordInput);this.addListener(this.$showPasswordToggle,"mousedown","onToggleMouseDown");this.hidePassword()},setCurrentInput:function(e){if(this.$currentInput){e.addClass("focus");this.$currentInput.replaceWith(e);e.focus();e.removeClass("focus");e.val(this.$currentInput.val())}this.$currentInput=e;this.addListener(this.$currentInput,"focus","onFocus");this.addListener(this.$currentInput,"keypress","onKeyPress");this.addListener(this.$currentInput,"keypress,keyup,change,blur","onInputChange")},updateToggleLabel:function(e){this.$showPasswordToggle.text(e)},showPassword:function(){if(this.showingPassword){return}this.hideCapsIcon();if(!this.$textInput){this.$textInput=this.$passwordInput.clone(true);this.$textInput.attr("type","text")}this.setCurrentInput(this.$textInput);this.updateToggleLabel(Garnish.PasswordInput.lang.Hide);this.showingPassword=true},hidePassword:function(){if(this.showingPassword===false){return}this.setCurrentInput(this.$passwordInput);this.updateToggleLabel(Garnish.PasswordInput.lang.Show);this.showingPassword=false;this.addListener(this.$passwordInput,"keydown","onKeyDown")},togglePassword:function(){if(this.showingPassword){this.hidePassword()}else{this.showPassword()}},showCapsIcon:function(){if(this.showingCapsIcon){return}this.$currentInput.addClass("capslock");this.showingCapsIcon=true},hideCapsIcon:function(){if(!this.showingCapsIcon){return}this.$currentInput.removeClass("capslock");this.showingCapsIcon=false},onFocus:function(){this.hideCapsIcon()},onKeyDown:function(e){if(e.keyCode==Garnish.ALT_KEY&&this.$currentInput.val()){this.showPassword();this.$showPasswordToggle.hide();this.addListener(this.$textInput,"keyup","onKeyUp")}},onKeyUp:function(e){e.preventDefault();if(e.keyCode==Garnish.ALT_KEY){this.hidePassword();this.$showPasswordToggle.show()}},onKeyPress:function(e){if(this.showingPassword){return}if(!e.shiftKey&&!e.metaKey){var f=String.fromCharCode(e.which);if(f.toUpperCase()===f&&f.toLowerCase()!==f){this.showCapsIcon()}else{if(f.toLowerCase()===f&&f.toUpperCase()!==f){this.hideCapsIcon()}}}},onInputChange:function(){if(this.$currentInput.val()){this.$showPasswordToggle.show()}else{this.$showPasswordToggle.hide()}},onToggleMouseDown:function(e){e.preventDefault();if(this.$currentInput[0].setSelectionRange){var f=this.$currentInput[0].selectionStart,g=this.$currentInput[0].selectionEnd}this.togglePassword();if(this.$currentInput[0].setSelectionRange){this.$currentInput[0].setSelectionRange(f,g)}}},{lang:{Show:"Show",Hide:"Hide"}});Garnish.Pill=Garnish.Base.extend({$outerContainer:null,$innerContainer:null,$btns:null,$selectedBtn:null,$input:null,init:function(e){this.$outerContainer=c(e);if(this.$outerContainer.data("pill")){Garnish.log("Double-instantiating a pill on an element");this.$outerContainer.data("pill").destroy()}this.$outerContainer.data("pill",this);this.$innerContainer=this.$outerContainer.find(".btngroup:first");this.$btns=this.$innerContainer.find(".btn");this.$selectedBtn=this.$btns.filter(".active:first");this.$input=this.$outerContainer.find("input:first");Garnish.preventOutlineOnMouseFocus(this.$innerContainer);this.addListener(this.$btns,"mousedown","onMouseDown");this.addListener(this.$innerContainer,"keydown","onKeyDown")},select:function(e){this.$selectedBtn.removeClass("active");var f=c(e);f.addClass("active");this.$input.val(f.attr("data-value"));this.$selectedBtn=f},onMouseDown:function(e){this.select(e.currentTarget)},_getSelectedBtnIndex:function(){if(typeof this.$selectedBtn[0]!="undefined"){return c.inArray(this.$selectedBtn[0],this.$btns)}else{return -1}},onKeyDown:function(g){switch(g.keyCode){case Garnish.RIGHT_KEY:if(!this.$selectedBtn.length){this.select(this.$btns[this.$btns.length-1])}else{var e=this._getSelectedBtnIndex()+1;if(typeof this.$btns[e]!="undefined"){this.select(this.$btns[e])}}g.preventDefault();break;case Garnish.LEFT_KEY:if(!this.$selectedBtn.length){this.select(this.$btns[0])}else{var f=this._getSelectedBtnIndex()-1;if(typeof this.$btns[f]!="undefined"){this.select(this.$btns[f])}}g.preventDefault();break}}});Garnish.Select=Garnish.Base.extend({$container:null,$items:null,totalSelected:null,mousedownX:null,mousedownY:null,mouseUpTimeout:null,mouseUpTimeoutDuration:null,callbackTimeout:null,$focusable:null,$first:null,first:null,$last:null,last:null,init:function(e,f,g){this.$container=c(e);if(!g&&Garnish.isObject(f)){g=f;f=null}if(this.$container.data("select")){Garnish.log("Double-instantiating a select on an element");this.$container.data("select").destroy()}this.$container.data("select",this);this.setSettings(g,Garnish.Select.defaults);this.mouseUpTimeoutDuration=(this.settings.waitForDblClick?300:0);this.$items=c();this.addItems(f);this.addListener(this.$container,"click",function(h){if(this.ignoreClick){this.ignoreClick=false}else{this.deselectAll(true)}})},getItemIndex:function(e){return this.$items.index(e[0])},isSelected:function(e){return e.hasClass(this.settings.selectedClass)},selectItem:function(e){if(!this.settings.multi){this.deselectAll()}e.addClass(this.settings.selectedClass);this.$first=this.$last=e;this.first=this.last=this.getItemIndex(e);this.setFocusableItem(e);e.focus();this.totalSelected++;this.setCallbackTimeout()},selectAll:function(){if(!this.settings.multi||!this.$items.length){return}this.first=0;this.last=this.$items.length-1;this.$first=c(this.$items[this.first]);this.$last=c(this.$items[this.last]);this.$items.addClass(this.settings.selectedClass);this.totalSelected=this.$items.length;this.setCallbackTimeout()},selectRange:function(f){if(!this.settings.multi){return this.selectItem(f)}this.deselectAll();this.$last=f;this.last=this.getItemIndex(f);this.setFocusableItem(f);f.focus();if(this.first<this.last){var e=this.first,g=this.last+1}else{var e=this.last,g=this.first+1}this.$items.slice(e,g).addClass(this.settings.selectedClass);this.totalSelected=g-e;this.setCallbackTimeout()},deselectItem:function(e){e.removeClass(this.settings.selectedClass);var f=this.getItemIndex(e);if(this.first===f){this.$first=this.first=null}if(this.last===f){this.$last=this.last=null}this.totalSelected--;this.setCallbackTimeout()},deselectAll:function(e){this.$items.removeClass(this.settings.selectedClass);if(e){this.$first=this.first=this.$last=this.last=null}this.totalSelected=0;this.setCallbackTimeout()},deselectOthers:function(e){this.deselectAll();this.selectItem(e)},toggleItem:function(e){if(!this.isSelected(e)){this.selectItem(e)}else{this.deselectItem(e)}},clearMouseUpTimeout:function(){clearTimeout(this.mouseUpTimeout)},onMouseDown:function(f){if(f.button!=Garnish.PRIMARY_CLICK){return}this.mousedownX=f.pageX;this.mousedownY=f.pageY;var e=c(c.data(f.currentTarget,"select-item"));if(f.metaKey){this.toggleItem(e)}else{if(this.first!==null&&f.shiftKey){this.selectRange(e)}else{if(!this.isSelected(e)){this.deselectAll();this.selectItem(e)}}}},onMouseUp:function(f){if(f.button!=Garnish.PRIMARY_CLICK){return}var e=c(c.data(f.currentTarget,"select-item"));if(!f.metaKey&&!f.shiftKey&&Garnish.getDist(this.mousedownX,this.mousedownY,f.pageX,f.pageY)<1){this.selectItem(e);this.clearMouseUpTimeout();this.mouseUpTimeout=setTimeout(c.proxy(function(){this.deselectOthers(e)},this),this.mouseUpTimeoutDuration)}},onKeyDown:function(g){var h=(g.metaKey||g.ctrlKey);if(this.settings.arrowsChangeSelection||!this.$focusable.length){var f=g.shiftKey?this.last:this.first}else{var f=c.inArray(this.$focusable[0],this.$items);if(f==-1){f=0}}switch(g.keyCode){case Garnish.LEFT_KEY:g.preventDefault();if(this.first===null){var e=this.getLastItem()}else{if(h){var e=this.getFurthestItemToTheLeft(f)}else{var e=this.getItemToTheLeft(f)}}break;case Garnish.RIGHT_KEY:g.preventDefault();if(this.first===null){var e=this.getFirstItem()}else{if(h){var e=this.getFurthestItemToTheRight(f)}else{var e=this.getItemToTheRight(f)}}break;case Garnish.UP_KEY:g.preventDefault();if(this.first===null){var e=this.getLastItem()}else{if(h){var e=this.getFurthestItemAbove(f)}else{var e=this.getItemAbove(f)}if(!e){e=this.getFirstItem()}}break;case Garnish.DOWN_KEY:g.preventDefault();if(this.first===null){var e=this.getFirstItem()}else{if(h){var e=this.getFurthestItemBelow(f)}else{var e=this.getItemBelow(f)}if(!e){e=this.getLastItem()}}break;case Garnish.SPACE_KEY:if(!h){g.preventDefault();if(this.isSelected(this.$focusable)){this.deselectItem(this.$focusable)}else{this.selectItem(this.$focusable)}}break;case Garnish.A_KEY:if(h){g.preventDefault();this.selectAll()}break}if(e&&e.length){if(this.settings.arrowsChangeSelection){if(this.first!==null&&g.shiftKey){this.selectRange(e)}else{this.deselectAll();this.selectItem(e)}}else{this.setFocusableItem(e);e.focus()}}},getFirstItem:function(){if(this.$items.length){return c(this.$items[0])}},getLastItem:function(){if(this.$items.length){return c(this.$items[this.$items.length-1])}},isPreviousItem:function(e){return(e>0)},isNextItem:function(e){return(e<this.$items.length-1)},getPreviousItem:function(e){if(this.isPreviousItem(e)){return c(this.$items[e-1])}},getNextItem:function(e){if(this.isNextItem(e)){return c(this.$items[e+1])}},getItemToTheLeft:function(e){if(this.isPreviousItem(e)){if(this.settings.horizontal){return this.getPreviousItem(e)}if(!this.settings.vertical){return this.getClosestItem(e,Garnish.X_AXIS,"<")}}},getItemToTheRight:function(e){if(this.isNextItem(e)){if(this.settings.horizontal){return this.getNextItem(e)}else{if(!this.settings.vertical){return this.getClosestItem(e,Garnish.X_AXIS,">")}}}},getItemAbove:function(e){if(this.isPreviousItem(e)){if(this.settings.vertical){return this.getPreviousItem(e)}else{if(!this.settings.horizontal){return this.getClosestItem(e,Garnish.Y_AXIS,"<")}}}},getItemBelow:function(e){if(this.isNextItem(e)){if(this.settings.vertical){return this.getNextItem(e)}else{if(!this.settings.horizontal){return this.getClosestItem(e,Garnish.Y_AXIS,">")}}}},getClosestItem:function(l,f,g){var e=Garnish.Select.closestItemAxisProps[f],k=Garnish.Select.closestItemDirectionProps[g];var q=c(this.$items[l]),p=q.offset(),r=p[e.midpointOffset]+Math.round(q[e.midpointSizeFunc]()/2),m=null,n=null,u=null;for(var h=l+k.step;(typeof this.$items[h]!="undefined");h+=k.step){var o=c(this.$items[h]),t=o.offset();if(k.isNextRow(t[e.rowOffset],p[e.rowOffset])){if(m===null){m=t[e.rowOffset]}else{if(t[e.rowOffset]!=m){break}}var s=t[e.midpointOffset]+Math.round(o[e.midpointSizeFunc]()/2),j=Math.abs(r-s);if(n===null||j<n){n=j;u=o}else{break}}else{if(k.isWrongDirection(t[e.rowOffset],p[e.rowOffset])){break}}}return u},getFurthestItemToTheLeft:function(e){return this.getFurthestItem(e,"ToTheLeft")},getFurthestItemToTheRight:function(e){return this.getFurthestItem(e,"ToTheRight")},getFurthestItemAbove:function(e){return this.getFurthestItem(e,"Above")},getFurthestItemBelow:function(e){return this.getFurthestItem(e,"Below")},getFurthestItem:function(h,g){var f,e;while(e=this["getItem"+g](h)){f=e;h=this.getItemIndex(f)}return f},getTotalSelected:function(){return this.totalSelected},addItems:function(e){var j=c(e);for(var f=0;f<j.length;f++){var g=j[f];if(c.data(g,"select")){Garnish.log("Element was added to more than one selector");c.data(g,"select").removeItems(g)}c.data(g,"select",this);this.$items=this.$items.add(g);if(this.settings.handle){if(typeof this.settings.handle=="object"){var h=c(this.settings.handle)}else{if(typeof this.settings.handle=="string"){var h=c(g).find(this.settings.handle)}else{if(typeof this.settings.handle=="function"){var h=c(this.settings.handle(g))}}}}else{var h=c(g)}c.data(g,"select-handle",h);h.data("select-item",g);this.addListener(h,"mousedown","onMouseDown");this.addListener(h,"mouseup","onMouseUp");this.addListener(h,"keydown","onKeyDown");this.addListener(h,"click",function(i){this.ignoreClick=true})}this.totalSelected+=j.filter("."+this.settings.selectedClass).length;this.updateIndexes()},removeItems:function(e){e=c.makeArray(e);for(var g=0;g<e.length;g++){var h=e[g];var f=c.inArray(h,this.$items);if(f!=-1){var j=c.data(h,"select-handle");j.data("select-item",null);c.data(h,"select",null);c.data(h,"select-handle",null);this.removeAllListeners(j);this.$items.splice(f,1)}}this.updateIndexes()},refreshItemOrder:function(){this.$items=c(this.$items)},destroy:function(){this.base();this.clearCallbackTimeout()},updateIndexes:function(){if(this.first!==null){this.first=this.getItemIndex(this.$first);this.last=this.getItemIndex(this.$last);this.setFocusableItem(this.$first)}else{if(this.$items.length){this.setFocusableItem(c(this.$items[0]))}}},resetItemOrder:function(){this.$items=c().add(this.$items);this.updateIndexes()},setFocusableItem:function(e){if(this.$focusable){this.$focusable.removeAttr("tabindex")}this.$focusable=e.attr("tabindex","0")},clearCallbackTimeout:function(){if(this.settings.onSelectionChange){clearTimeout(this.callbackTimeout)}},setCallbackTimeout:function(){if(this.settings.onSelectionChange){this.clearCallbackTimeout();this.callbackTimeout=setTimeout(c.proxy(function(){this.callbackTimeout=null;this.settings.onSelectionChange()},this),300)}},getSelectedItems:function(){return this.$items.filter("."+this.settings.selectedClass)}},{defaults:{selectedClass:"sel",multi:false,vertical:false,horizontal:false,waitForDblClick:false,arrowsChangeSelection:true,handle:null,onSelectionChange:c.noop},closestItemAxisProps:{x:{midpointOffset:"top",midpointSizeFunc:"outerHeight",rowOffset:"left"},y:{midpointOffset:"left",midpointSizeFunc:"outerWidth",rowOffset:"top"}},closestItemDirectionProps:{"<":{step:-1,isNextRow:function(f,e){return(f<e)},isWrongDirection:function(f,e){return(f>e)}},">":{step:1,isNextRow:function(f,e){return(f>e)},isWrongDirection:function(f,e){return(f<e)}}}});Garnish.SelectMenu=Garnish.Menu.extend({init:function(f,e,g,h){if(typeof g=="function"){h=g;g={}}g=c.extend({},Garnish.SelectMenu.defaults,g);this.base(f,e,g,h);this.selected=-1},build:function(){this.base();if(this.selected!=-1){this._addSelectedOptionClass(this.selected)}},select:function(e){if(e==this.selected){return}if(this.dom.ul){if(this.selected!=-1){this.dom.options[this.selected].className=""}this._addSelectedOptionClass(e)}this.selected=e;this.setBtnText(c(this.options[e].label).text());this.base(e)},_addSelectedOptionClass:function(e){this.dom.options[e].className="sel"},setBtnText:function(e){this.dom.$btnLabel.text(e)}},{defaults:{ulClass:"menu select"}})})(jQuery);